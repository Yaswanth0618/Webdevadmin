<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="x-icon" href="icon1.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <title>Admin Portal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />

    <!-- font awesome link -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">


    <link rel="stylesheet" href="main.css" />

    


    <!-- Swiper CSS
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    /> -->
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
    </script>
    <script type="text/javascript">
      (function(){
          emailjs.init({
            publicKey: "FoJRUS4Q8qc3vyF5T",
          });
      })();
    </script>

    



  </head>


  <body class="bodymain">
    <header>
      <a href="#" class="logo">
        <img src="admin logo.png" width="50px" />
        <div class="log_text">Admin Portal</div>
      </a>

      <!--Back to main website button-->
      <div class="main-website-btn">
        <button class="btn2"><a href="https://yaswanth0618.github.io/WebDevFBLA/">Back to Home Website</a></button>
      </div>

      <!-- <p>Experience the taste of excellence</p> -->

      <div class="signout_btn">
        <button class="btn"><a href="index.html">Signout</a></button>
        
        <i class="fa-solid fa-bars" id="bar"></i>
      </div>
    </header>
    <br>
    
    <div class="container mt-3">
      <br>
      <br>
      <!--Create a table with columns-->
      <table class="table">
        <thead>
          <th>Applicant Number</th>
          <th>Full Name</th>
          <th>Application Form</th>
          <th>Control</th>
        </thead>
        <tbody id = "tbody1"></tbody>
      </table>
    </div>

    <hr id="redSeparator">

    <div id="detailsPanel" class="hidden">
      <h3>Applicant Responses</h3>
      <br>
      <!--Create a format for viewing applications-->
      <p><strong id="applicationFormLabel">Application Form:</strong> <span id="applicationForm"></span></p>
      <p><strong id="fullNameLabel">Full Name:</strong> <span id="fullName"></span></p>
      <p><strong id="emailLabel">Email:</strong> <span id="email"></span></p>
      <p><strong id="dobLabel">DOB:</strong> <span id="dob"></span></p>
      <p><strong id="addressLabel">Address:</strong> <span id="address"></span></p>
      <p><strong id="stateLabel">State:</strong> <span id="state"></span></p>
      <p><strong id="zipLabel">ZIP:</strong> <span id="zip"></span></p>
      <p><strong id="educationLabel">Education:</strong> <span id="education"></span></p>
      <p><strong id="coverLetterLabel">Cover Letter:</strong> <span id="coverletter"></span></p>
      <p><strong id="employmentHistoryLabel">Employment History:</strong> <span id="employmenthistory"></span></p>
      <p><strong id="skillsCertificationsLabel">Skills and Certifications:</strong> <span id="skillsandcertifications"></span></p>
      <p><strong id="experienceLabel">Experience:</strong> <span id="experience"></span></p>
      <p><strong id="multitaskLabel">Multitask:</strong> <span id="multitask"></span></p>
      <p><strong id="accuracyLabel">Accuracy:</strong> <span id="accuracy"></span></p>
      <p><strong id="qualityLabel">Quality:</strong> <span id="quality"></span></p>
      <p><strong id="whyWorkHereLabel">Why Work Here:</strong> <span id="whyworkhere"></span></p>
      <p><strong id="expectedSalaryLabel">Expected Salary:</strong> <span id="expectedsalary"></span></p>
      <p><strong id="bestCandidateSkillsLabel">Best Candidate Skills:</strong> <span id="bestcandidateskills"></span></p>
      <p><strong id="motivationsAtWorkLabel">Motivations At Work:</strong> <span id="motivationsatwork"></span></p>
      <p><strong id="resumeLabel">Resume:</strong> <a id="resumeLink" href="#" target="_blank">View Resume</a></p>
    </div>

    <div id="plainPanel" class="hidden">
      <p id="separator"></p>
      <br>
      <!--Create a format for viewing applications-->
    </div>

    <script>
      // Check if the user is logged in
      if (!localStorage.getItem('isLoggedIn') || localStorage.getItem('isLoggedIn') !== 'true') {
        // Redirect to the login page
        window.location.href = 'index.html';
      }
    </script>

    <script>
      function closeDetailsPanel() {
        document.getElementById('detailsPanel').classList.add('hidden');
      }
    </script>

    
    <script src="https://smtpjs.com/v3/smtp.js"></script>
    

    <script type="module">
      //Get Database
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import { getStorage, ref as refsto, getDownloadURL, uploadBytes } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";
      
  
      const firebaseConfig = {
        apiKey: "AIzaSyAO9zhttsR2jhYQPBpsNiAzBPPMD8ZJtno",
        authDomain: "fbla-restaurant-db.firebaseapp.com",
        databaseURL: "https://fbla-restaurant-db-default-rtdb.firebaseio.com",
        projectId: "fbla-restaurant-db",
        storageBucket: "fbla-restaurant-db.appspot.com",
        
        messagingSenderId: "1032671063739",
        appId: "1:1032671063739:web:93e3567aade232b2db839e"
      };


      const app = initializeApp(firebaseConfig);
      import { getDatabase, ref, child, onValue, get, remove} from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";
      const db = getDatabase();
      const storage = getStorage();


    
      
      var stdNo = 0;
      var tbody = document.getElementById('tbody1');

      
      //Add items to table from fb db
      function AddItemToTable(fullName, applicationForm, email, dob, address, state, zip, education, employmenthistory, skillsandcertifications, experience, multitask, accuracy, quality, whyworkhere, expectedsalary, bestcandidateskills, motivationsatwork, coverletter){
        let trow = document.createElement("tr");
        let td1 = document.createElement('td');
        let td2 = document.createElement('td');
        let td3 = document.createElement('td');
        let td4 = document.createElement('td');

        td1.innerHTML = ++stdNo;
        td2.innerHTML = fullName;
        td3.innerHTML = applicationForm;


        //Create a view button
        let viewButton = document.createElement('button');
        viewButton.textContent = 'View';
        viewButton.classList.add('btn', 'btn-primary', 'mr-1', 'view-button');
        

        //Create an accept button
        let acceptButton = document.createElement('button');
        acceptButton.textContent = 'Accept';
        acceptButton.classList.add('btn', 'btn-success', 'mr-1', 'accept-button', 'btn-sm');
        acceptButton.addEventListener('click', function() {

          document.getElementById('plainPanel').classList.remove('hidden');
          console.log(email)

          emailjs.send("service_f6xywlm","template_1d9qird", {emailsend : email}).then(alert("Decision Sent!!!"))
          

          
         
        document.getElementById('detailsPanel').classList.add('hidden');
        

          //remove application from db
          remove(ref(db, 'fullName/' + fullName));

          var rows = document.querySelectorAll("#tbody1 tr");
          rows.forEach(function(row) {
            if (row.cells[1].textContent == fullName) {
              //remove application from table
              row.remove();
            }
          });


        });

        
      

        // Create reject button
        let rejectButton = document.createElement('button');
        rejectButton.textContent = 'Reject';
        rejectButton.classList.add('btn', 'btn-danger', 'reject-button', 'btn-sm');
        rejectButton.addEventListener('click', function() {
          document.getElementById('plainPanel').classList.remove('hidden');
          emailjs.send("service_f6xywlm","template_w3xhblh", {emailsend : email}).then(alert("Decision Sent!!!"))
        document.getElementById('detailsPanel').classList.add('hidden');

          //remove application from db
          remove(ref(db, 'fullName/' + fullName));


          var rows = document.querySelectorAll("#tbody1 tr");
          rows.forEach(function(row) {
            if (row.cells[1].textContent == fullName) {
              //remove application from table
              row.remove();
            }
          });

        });

        td4.appendChild(viewButton);
        td4.appendChild(acceptButton);
        td4.appendChild(rejectButton);

        function scrollToBottom() {
          setTimeout(() => {
            var offset = document.body.scrollHeight - window.innerHeight - 450; 
            window.scrollTo({ top: offset, behavior: 'smooth' });
          }, 100); 
        }


        
        // GM
        if (applicationForm == "General Manager Application Form") {
          viewButton.addEventListener('click', function() {
            var highlightedRows = document.querySelectorAll('.highlighted-row');
            highlightedRows.forEach(function(row) {
              row.classList.remove('highlighted-row');
            });

            // Find the table row to highlight
            var row = event.target.closest('tr');
            if (row) 
              // Add the highlighted class to the clicked row
              row.classList.add('highlighted-row');
            
            scrollToBottom();
              var isHidden = detailsPanel.classList.contains('hidden');
              // Clear existing content
              document.getElementById('applicationForm').textContent = "";
              document.getElementById('fullName').textContent = "";
              document.getElementById('email').textContent = "";
              document.getElementById('dob').textContent = "";
              document.getElementById('address').textContent = "";
              document.getElementById('state').textContent = "";
              document.getElementById('zip').textContent = "";
              document.getElementById('education').textContent = "";
              document.getElementById('employmenthistory').textContent = "";
              document.getElementById('skillsandcertifications').textContent = "";
              document.getElementById('experience').textContent = "";
              document.getElementById('multitask').textContent = "N/A";
              document.getElementById('accuracy').textContent = "N/A";
              document.getElementById('quality').textContent = "N/A";
              document.getElementById('whyworkhere').textContent = "";
              document.getElementById('expectedsalary').textContent = "";
              document.getElementById('bestcandidateskills').textContent = "";
              document.getElementById('motivationsatwork').textContent = "";
              document.getElementById('coverletter').textContent = "";

      
              // Populate elements with application form data
              document.getElementById('applicationForm').textContent = `${applicationForm}`;
              document.getElementById('fullName').textContent = `${fullName}`;
              document.getElementById('email').textContent = `${email}`;
              document.getElementById('dob').textContent = `${dob}`;
              document.getElementById('address').textContent = `${address}`;
              document.getElementById('state').textContent = `${state}`;
              document.getElementById('zip').textContent = `${zip}`;
              document.getElementById('education').textContent = `${education}`;
              document.getElementById('coverletter').textContent = `${coverletter}`;
              document.getElementById('employmenthistory').textContent = `${employmenthistory}`;
              document.getElementById('skillsandcertifications').textContent = `${skillsandcertifications}`;
              document.getElementById('experience').textContent = `${experience}`;
              document.getElementById('whyworkhere').textContent = `${whyworkhere}`;
              document.getElementById('expectedsalary').textContent = `${expectedsalary}`;
              document.getElementById('bestcandidateskills').textContent = `${bestcandidateskills}`;
              document.getElementById('motivationsatwork').textContent = `${motivationsatwork}`;


              const storageRef = refsto(storage, `resumes/${fullName}/${fullName}.pdf`); // Adjust the file path as needed
              getDownloadURL(storageRef)
                .then((url) => {
                  document.getElementById('resumeLink').href = url;
                  document.getElementById('resumeLink').textContent = "View Resume";
                })
                .catch((error) => {
                  console.error("Error fetching resume URL:", error);
                });



            
      
              
              // Show details panel
              if (isHidden){
                document.getElementById('detailsPanel').classList.remove('hidden');
                
              } else {
                document.getElementById('detailsPanel').classList.add('hidden');
                row.classList.remove('highlighted-row');
              }
              
          });
        }
      
        //Cashier
        if (applicationForm == "Cashier Application Form") {
          
          viewButton.addEventListener('click', function() {
            var highlightedRows = document.querySelectorAll('.highlighted-row');
            highlightedRows.forEach(function(row) {
              row.classList.remove('highlighted-row');
            });

            // Find the table row to highlight
            var row = event.target.closest('tr');
            if (row) 
              // Add the highlighted class to the clicked row
              row.classList.add('highlighted-row');
            scrollToBottom();
              var isHidden = detailsPanel.classList.contains('hidden');
              // Clear existing content
              document.getElementById('applicationForm').textContent = "";
              document.getElementById('fullName').textContent = "";
              document.getElementById('email').textContent = "";
              document.getElementById('dob').textContent = "";
              document.getElementById('address').textContent = "";
              document.getElementById('state').textContent = "";
              document.getElementById('zip').textContent = "";
              document.getElementById('education').textContent = "";
              document.getElementById('employmenthistory').textContent = "";
              document.getElementById('skillsandcertifications').textContent = "";
              document.getElementById('experience').textContent = "N/A";
              document.getElementById('multitask').textContent = "";
              document.getElementById('accuracy').textContent = "N/A";
              document.getElementById('quality').textContent = "N/A";
              document.getElementById('whyworkhere').textContent = "";
              document.getElementById('expectedsalary').textContent = "";
              document.getElementById('bestcandidateskills').textContent = "";
              document.getElementById('motivationsatwork').textContent = "";
              document.getElementById('coverletter').textContent = "";
      
              // Populate elements with application form data
              document.getElementById('applicationForm').textContent = `${applicationForm}`;
              document.getElementById('fullName').textContent = `${fullName}`;
              document.getElementById('email').textContent = `${email}`;
              document.getElementById('dob').textContent = `${dob}`;
              document.getElementById('address').textContent = `${address}`;
              document.getElementById('state').textContent = `${state}`;
              document.getElementById('zip').textContent = `${zip}`;
              document.getElementById('education').textContent = `${education}`;
              document.getElementById('coverletter').textContent = `${coverletter}`;
              document.getElementById('employmenthistory').textContent = `${employmenthistory}`;
              document.getElementById('multitask').textContent = `${multitask}`;
              document.getElementById('whyworkhere').textContent = `${whyworkhere}`;
              document.getElementById('expectedsalary').textContent = `${expectedsalary}`;
              document.getElementById('bestcandidateskills').textContent = `${bestcandidateskills}`;
              document.getElementById('motivationsatwork').textContent = `${motivationsatwork}`;

              const storageRef = refsto(storage, `resumes/${fullName}/${fullName}.pdf`); // Adjust the file path as needed
              getDownloadURL(storageRef)
                .then((url) => {
                  document.getElementById('resumeLink').href = url;
                  document.getElementById('resumeLink').textContent = "View Resume";
                })
                .catch((error) => {
                  console.error("Error fetching resume URL:", error);
                });
              
              if (isHidden){
                document.getElementById('detailsPanel').classList.remove('hidden');
              } else {
                document.getElementById('detailsPanel').classList.add('hidden');
                row.classList.remove('highlighted-row');
              }
          });
      }
      
      // Waiter/Waitress Application Form
      if (applicationForm == "Waiter/Waitress Application Form") {

          viewButton.addEventListener('click', function() {
            var highlightedRows = document.querySelectorAll('.highlighted-row');
            highlightedRows.forEach(function(row) {
              row.classList.remove('highlighted-row');
            });

            // Find the table row to highlight
            var row = event.target.closest('tr');
            if (row) 
              // Add the highlighted class to the clicked row
              row.classList.add('highlighted-row');
            scrollToBottom();
            var isHidden = detailsPanel.classList.contains('hidden');
              // Clear existing content
              document.getElementById('applicationForm').textContent = "";
              document.getElementById('fullName').textContent = "";
              document.getElementById('email').textContent = "";
              document.getElementById('dob').textContent = "";
              document.getElementById('address').textContent = "";
              document.getElementById('state').textContent = "";
              document.getElementById('zip').textContent = "";
              document.getElementById('education').textContent = "";
              document.getElementById('employmenthistory').textContent = "";
              document.getElementById('skillsandcertifications').textContent = "";
              document.getElementById('experience').textContent = "N/A";
              document.getElementById('multitask').textContent = "N/A";
              document.getElementById('accuracy').textContent = "";
              document.getElementById('quality').textContent = "N/A";
              document.getElementById('whyworkhere').textContent = "";
              document.getElementById('expectedsalary').textContent = "";
              document.getElementById('bestcandidateskills').textContent = "";
              document.getElementById('motivationsatwork').textContent = "";
              document.getElementById('coverletter').textContent = "";
      
              // Populate elements with application form data
              document.getElementById('applicationForm').textContent = `${applicationForm}`;
              document.getElementById('fullName').textContent = `${fullName}`;
              document.getElementById('email').textContent = `${email}`;
              document.getElementById('dob').textContent = `${dob}`;
              document.getElementById('address').textContent = `${address}`;
              document.getElementById('state').textContent = `${state}`;
              document.getElementById('zip').textContent = `${zip}`;
              document.getElementById('education').textContent = `${education}`;
              document.getElementById('coverletter').textContent = `${coverletter}`;
              document.getElementById('employmenthistory').textContent = `${employmenthistory}`;
              
              document.getElementById('accuracy').textContent = `${accuracy}`;
              document.getElementById('whyworkhere').textContent = `${whyworkhere}`;
              document.getElementById('expectedsalary').textContent = `${expectedsalary}`;
              document.getElementById('bestcandidateskills').textContent = `${bestcandidateskills}`;
              document.getElementById('motivationsatwork').textContent = `${motivationsatwork}`;


              const storageRef = refsto(storage, `resumes/${fullName}/${fullName}.pdf`); // Adjust the file path as needed
              getDownloadURL(storageRef)
                .then((url) => {
                  document.getElementById('resumeLink').href = url;
                  document.getElementById('resumeLink').textContent = "View Resume";
                })
                .catch((error) => {
                  console.error("Error fetching resume URL:", error);
                });


              
              
              if (isHidden){
                document.getElementById('detailsPanel').classList.remove('hidden');
              } else {
                document.getElementById('detailsPanel').classList.add('hidden');
                row.classList.remove('highlighted-row');
              }
          });
      }
      
        //Sous Chef
      if (applicationForm == "Sous Chef Application Form") {
          viewButton.addEventListener('click', function() {
            var highlightedRows = document.querySelectorAll('.highlighted-row');
            highlightedRows.forEach(function(row) {
              row.classList.remove('highlighted-row');
            });

            // Find the table row to highlight
            var row = event.target.closest('tr');
            if (row) 
              // Add the highlighted class to the clicked row
              row.classList.add('highlighted-row');
            scrollToBottom();
            var isHidden = detailsPanel.classList.contains('hidden');
              // Clear existing content
              document.getElementById('applicationForm').textContent = "";
              document.getElementById('fullName').textContent = "";
              document.getElementById('email').textContent = "";
              document.getElementById('dob').textContent = "";
              document.getElementById('address').textContent = "";
              document.getElementById('state').textContent = "";
              document.getElementById('zip').textContent = "";
              document.getElementById('education').textContent = "";
              document.getElementById('employmenthistory').textContent = "";
              document.getElementById('skillsandcertifications').textContent = "";
              document.getElementById('experience').textContent = "N/A";
              document.getElementById('multitask').textContent = "N/A";
              document.getElementById('accuracy').textContent = "N/A";
              document.getElementById('quality').textContent = "";
              document.getElementById('whyworkhere').textContent = "";
              document.getElementById('expectedsalary').textContent = "";
              document.getElementById('bestcandidateskills').textContent = "";
              document.getElementById('motivationsatwork').textContent = "";
              document.getElementById('coverletter').textContent = "";
      
              // Populate elements with application form data
              document.getElementById('applicationForm').textContent = `${applicationForm}`;
              document.getElementById('fullName').textContent = `${fullName}`;
              document.getElementById('email').textContent = `${email}`;
              document.getElementById('dob').textContent = `${dob}`;
              document.getElementById('address').textContent = `${address}`;
              document.getElementById('state').textContent = `${state}`;
              document.getElementById('zip').textContent = `${zip}`;
              document.getElementById('education').textContent = `${education}`;
              document.getElementById('coverletter').textContent = `${coverletter}`;
              document.getElementById('employmenthistory').textContent = `${employmenthistory}`;
              document.getElementById('skillsandcertifications').textContent = `${skillsandcertifications}`;
              document.getElementById('quality').textContent = `${quality}`;
              document.getElementById('whyworkhere').textContent = `${whyworkhere}`;
              document.getElementById('expectedsalary').textContent = `${expectedsalary}`;
              document.getElementById('bestcandidateskills').textContent = `${bestcandidateskills}`;
              document.getElementById('motivationsatwork').textContent = `${motivationsatwork}`;

              const storageRef = refsto(storage, `resumes/${fullName}/${fullName}.pdf`); // Adjust the file path as needed
              getDownloadURL(storageRef)
                .then((url) => {
                  document.getElementById('resumeLink').href = url;
                  document.getElementById('resumeLink').textContent = "View Resume";
                })
                .catch((error) => {
                  console.error("Error fetching resume URL:", error);
                });
              
              if (isHidden){
                document.getElementById('detailsPanel').classList.remove('hidden');
              } else {
                document.getElementById('detailsPanel').classList.add('hidden');
                row.classList.remove('highlighted-row');
              }
          });
      }


      // SS
      if (applicationForm == "Shift Supervisor Application Form") {
        viewButton.addEventListener('click', function() {
          var highlightedRows = document.querySelectorAll('.highlighted-row');
          highlightedRows.forEach(function(row) {
            row.classList.remove('highlighted-row');
          });

          // Find the table row to highlight
          var row = event.target.closest('tr');
          if (row) 
            // Add the highlighted class to the clicked row
            row.classList.add('highlighted-row');
          
          scrollToBottom();
            var isHidden = detailsPanel.classList.contains('hidden');
            // Clear existing content
            document.getElementById('applicationForm').textContent = "";
            document.getElementById('fullName').textContent = "";
            document.getElementById('email').textContent = "";
            document.getElementById('dob').textContent = "";
            document.getElementById('address').textContent = "";
            document.getElementById('state').textContent = "";
            document.getElementById('zip').textContent = "";
            document.getElementById('education').textContent = "";
            document.getElementById('employmenthistory').textContent = "";
            document.getElementById('skillsandcertifications').textContent = "";
            document.getElementById('experience').textContent = "";
            document.getElementById('multitask').textContent = "N/A";
            document.getElementById('accuracy').textContent = "N/A";
            document.getElementById('quality').textContent = "N/A";
            document.getElementById('whyworkhere').textContent = "";
            document.getElementById('expectedsalary').textContent = "";
            document.getElementById('bestcandidateskills').textContent = "";
            document.getElementById('motivationsatwork').textContent = "";
            document.getElementById('coverletter').textContent = "";

    
            // Populate elements with application form data
            document.getElementById('applicationForm').textContent = `${applicationForm}`;
            document.getElementById('fullName').textContent = `${fullName}`;
            document.getElementById('email').textContent = `${email}`;
            document.getElementById('dob').textContent = `${dob}`;
            document.getElementById('address').textContent = `${address}`;
            document.getElementById('state').textContent = `${state}`;
            document.getElementById('zip').textContent = `${zip}`;
            document.getElementById('education').textContent = `${education}`;
            document.getElementById('coverletter').textContent = `${coverletter}`;
            document.getElementById('employmenthistory').textContent = `${employmenthistory}`;
            document.getElementById('skillsandcertifications').textContent = `${skillsandcertifications}`;
            document.getElementById('experience').textContent = `${experience}`;
            document.getElementById('whyworkhere').textContent = `${whyworkhere}`;
            document.getElementById('expectedsalary').textContent = `${expectedsalary}`;
            document.getElementById('bestcandidateskills').textContent = `${bestcandidateskills}`;
            document.getElementById('motivationsatwork').textContent = `${motivationsatwork}`;


            const storageRef = refsto(storage, `resumes/${fullName}/${fullName}.pdf`); // Adjust the file path as needed
            getDownloadURL(storageRef)
              .then((url) => {
                document.getElementById('resumeLink').href = url;
                document.getElementById('resumeLink').textContent = "View Resume";
              })
              .catch((error) => {
                console.error("Error fetching resume URL:", error);
              });



          
    
            
            // Show details panel
            if (isHidden){
              document.getElementById('detailsPanel').classList.remove('hidden');
              
            } else {
              document.getElementById('detailsPanel').classList.add('hidden');
              row.classList.remove('highlighted-row');
            }
            
        });
      }



      //Dish Cleaner
      if (applicationForm == "Dish Cleaner Application Form") {
          
        viewButton.addEventListener('click', function() {
          var highlightedRows = document.querySelectorAll('.highlighted-row');
          highlightedRows.forEach(function(row) {
            row.classList.remove('highlighted-row');
          });

          // Find the table row to highlight
          var row = event.target.closest('tr');
          if (row) 
            // Add the highlighted class to the clicked row
            row.classList.add('highlighted-row');
          scrollToBottom();
            var isHidden = detailsPanel.classList.contains('hidden');
            // Clear existing content
            document.getElementById('applicationForm').textContent = "";
            document.getElementById('fullName').textContent = "";
            document.getElementById('email').textContent = "";
            document.getElementById('dob').textContent = "";
            document.getElementById('address').textContent = "";
            document.getElementById('state').textContent = "";
            document.getElementById('zip').textContent = "";
            document.getElementById('education').textContent = "";
            document.getElementById('employmenthistory').textContent = "";
            document.getElementById('skillsandcertifications').textContent = "";
            document.getElementById('experience').textContent = "N/A";
            document.getElementById('multitask').textContent = "";
            document.getElementById('accuracy').textContent = "N/A";
            document.getElementById('quality').textContent = "N/A";
            document.getElementById('whyworkhere').textContent = "";
            document.getElementById('expectedsalary').textContent = "";
            document.getElementById('bestcandidateskills').textContent = "";
            document.getElementById('motivationsatwork').textContent = "";
            document.getElementById('coverletter').textContent = "";
    
            // Populate elements with application form data
            document.getElementById('applicationForm').textContent = `${applicationForm}`;
            document.getElementById('fullName').textContent = `${fullName}`;
            document.getElementById('email').textContent = `${email}`;
            document.getElementById('dob').textContent = `${dob}`;
            document.getElementById('address').textContent = `${address}`;
            document.getElementById('state').textContent = `${state}`;
            document.getElementById('zip').textContent = `${zip}`;
            document.getElementById('education').textContent = `${education}`;
            document.getElementById('coverletter').textContent = `${coverletter}`;
            document.getElementById('employmenthistory').textContent = `${employmenthistory}`;
            document.getElementById('multitask').textContent = `${multitask}`;
            document.getElementById('whyworkhere').textContent = `${whyworkhere}`;
            document.getElementById('expectedsalary').textContent = `${expectedsalary}`;
            document.getElementById('bestcandidateskills').textContent = `${bestcandidateskills}`;
            document.getElementById('motivationsatwork').textContent = `${motivationsatwork}`;

            const storageRef = refsto(storage, `resumes/${fullName}/${fullName}.pdf`); // Adjust the file path as needed
            getDownloadURL(storageRef)
              .then((url) => {
                document.getElementById('resumeLink').href = url;
                document.getElementById('resumeLink').textContent = "View Resume";
              })
              .catch((error) => {
                console.error("Error fetching resume URL:", error);
              });
            
            if (isHidden){
              document.getElementById('detailsPanel').classList.remove('hidden');
            } else {
              document.getElementById('detailsPanel').classList.add('hidden');
              row.classList.remove('highlighted-row');
            }
        });
    }


    //Maintenance Worker  Application Form
    if (applicationForm == "Maintenance Worker Application Form") {

      viewButton.addEventListener('click', function() {
        var highlightedRows = document.querySelectorAll('.highlighted-row');
        highlightedRows.forEach(function(row) {
          row.classList.remove('highlighted-row');
        });

        // Find the table row to highlight
        var row = event.target.closest('tr');
        if (row) 
          // Add the highlighted class to the clicked row
          row.classList.add('highlighted-row');
        scrollToBottom();
        var isHidden = detailsPanel.classList.contains('hidden');
          // Clear existing content
          document.getElementById('applicationForm').textContent = "";
          document.getElementById('fullName').textContent = "";
          document.getElementById('email').textContent = "";
          document.getElementById('dob').textContent = "";
          document.getElementById('address').textContent = "";
          document.getElementById('state').textContent = "";
          document.getElementById('zip').textContent = "";
          document.getElementById('education').textContent = "";
          document.getElementById('employmenthistory').textContent = "";
          document.getElementById('skillsandcertifications').textContent = "";
          document.getElementById('experience').textContent = "N/A";
          document.getElementById('multitask').textContent = "N/A";
          document.getElementById('accuracy').textContent = "";
          document.getElementById('quality').textContent = "N/A";
          document.getElementById('whyworkhere').textContent = "";
          document.getElementById('expectedsalary').textContent = "";
          document.getElementById('bestcandidateskills').textContent = "";
          document.getElementById('motivationsatwork').textContent = "";
          document.getElementById('coverletter').textContent = "";
  
          // Populate elements with application form data
          document.getElementById('applicationForm').textContent = `${applicationForm}`;
          document.getElementById('fullName').textContent = `${fullName}`;
          document.getElementById('email').textContent = `${email}`;
          document.getElementById('dob').textContent = `${dob}`;
          document.getElementById('address').textContent = `${address}`;
          document.getElementById('state').textContent = `${state}`;
          document.getElementById('zip').textContent = `${zip}`;
          document.getElementById('education').textContent = `${education}`;
          document.getElementById('coverletter').textContent = `${coverletter}`;
          document.getElementById('employmenthistory').textContent = `${employmenthistory}`;
          
          document.getElementById('accuracy').textContent = `${accuracy}`;
          document.getElementById('whyworkhere').textContent = `${whyworkhere}`;
          document.getElementById('expectedsalary').textContent = `${expectedsalary}`;
          document.getElementById('bestcandidateskills').textContent = `${bestcandidateskills}`;
          document.getElementById('motivationsatwork').textContent = `${motivationsatwork}`;


          const storageRef = refsto(storage, `resumes/${fullName}/${fullName}.pdf`); // Adjust the file path as needed
          getDownloadURL(storageRef)
            .then((url) => {
              document.getElementById('resumeLink').href = url;
              document.getElementById('resumeLink').textContent = "View Resume";
            })
            .catch((error) => {
              console.error("Error fetching resume URL:", error);
            });


          
          
          if (isHidden){
            document.getElementById('detailsPanel').classList.remove('hidden');
          } else {
            document.getElementById('detailsPanel').classList.add('hidden');
            row.classList.remove('highlighted-row');
          }
      });
  }



    //Training Coordinator
    if (applicationForm == "Training Coordinator Application Form") {
      viewButton.addEventListener('click', function() {
        var highlightedRows = document.querySelectorAll('.highlighted-row');
        highlightedRows.forEach(function(row) {
          row.classList.remove('highlighted-row');
        });

        // Find the table row to highlight
        var row = event.target.closest('tr');
        if (row) 
          // Add the highlighted class to the clicked row
          row.classList.add('highlighted-row');
        scrollToBottom();
        var isHidden = detailsPanel.classList.contains('hidden');
          // Clear existing content
          document.getElementById('applicationForm').textContent = "";
          document.getElementById('fullName').textContent = "";
          document.getElementById('email').textContent = "";
          document.getElementById('dob').textContent = "";
          document.getElementById('address').textContent = "";
          document.getElementById('state').textContent = "";
          document.getElementById('zip').textContent = "";
          document.getElementById('education').textContent = "";
          document.getElementById('employmenthistory').textContent = "";
          document.getElementById('skillsandcertifications').textContent = "";
          document.getElementById('experience').textContent = "N/A";
          document.getElementById('multitask').textContent = "N/A";
          document.getElementById('accuracy').textContent = "N/A";
          document.getElementById('quality').textContent = "";
          document.getElementById('whyworkhere').textContent = "";
          document.getElementById('expectedsalary').textContent = "";
          document.getElementById('bestcandidateskills').textContent = "";
          document.getElementById('motivationsatwork').textContent = "";
          document.getElementById('coverletter').textContent = "";
  
          // Populate elements with application form data
          document.getElementById('applicationForm').textContent = `${applicationForm}`;
          document.getElementById('fullName').textContent = `${fullName}`;
          document.getElementById('email').textContent = `${email}`;
          document.getElementById('dob').textContent = `${dob}`;
          document.getElementById('address').textContent = `${address}`;
          document.getElementById('state').textContent = `${state}`;
          document.getElementById('zip').textContent = `${zip}`;
          document.getElementById('education').textContent = `${education}`;
          document.getElementById('coverletter').textContent = `${coverletter}`;
          document.getElementById('employmenthistory').textContent = `${employmenthistory}`;
          document.getElementById('skillsandcertifications').textContent = `${skillsandcertifications}`;
          document.getElementById('quality').textContent = `${quality}`;
          document.getElementById('whyworkhere').textContent = `${whyworkhere}`;
          document.getElementById('expectedsalary').textContent = `${expectedsalary}`;
          document.getElementById('bestcandidateskills').textContent = `${bestcandidateskills}`;
          document.getElementById('motivationsatwork').textContent = `${motivationsatwork}`;

          const storageRef = refsto(storage, `resumes/${fullName}/${fullName}.pdf`); // Adjust the file path as needed
          getDownloadURL(storageRef)
            .then((url) => {
              document.getElementById('resumeLink').href = url;
              document.getElementById('resumeLink').textContent = "View Resume";
            })
            .catch((error) => {
              console.error("Error fetching resume URL:", error);
            });
          
          if (isHidden){
            document.getElementById('detailsPanel').classList.remove('hidden');
          } else {
            document.getElementById('detailsPanel').classList.add('hidden');
            row.classList.remove('highlighted-row');
          }
      });
  }
      

        


        trow.appendChild(td1);
        trow.appendChild(td2);
        trow.appendChild(td3);
        trow.appendChild(td4); 
        
        // Add td for control buttons


        tbody.appendChild(trow);

      }

      //Add all items from fb db to the table
      function AddAllItemsToTable(TheApplicant){
        stdNo = 0;
        tbody.innerHTML="";
        TheApplicant.forEach(element => {
          AddItemToTable(
              element.fullName,
              element.applicationForm,
              element.email,
              element.dob,
              element.address,
              element.state,
              element.zip,
              element.education,
              element.employmenthistory,
              element.skillsandcertifications,
              element.experience,
              element.multitask,
              element.accuracy,
              element.quality,
              element.whyworkhere,
              element.expectedsalary,
              element.bestcandidateskills,
              element.motivationsatwork,
              element.coverletter
          );
      });
    }

      
      

      //get data from fb db to view applications
      function GetAllDataOnce(){
        const dbRef = ref(db);

        get(child(dbRef, "fullName"))
        .then((snapshot) =>{
          var applicants = [];

          snapshot.forEach(childSnapshot => {
            applicants.push(childSnapshot.val());
          });
          AddAllItemsToTable(applicants);
        });
      }

      function GetAllDataRealtime(){
        const dbRef = ref(db, "fullName");

        onValue(dbref, (snapshot) => {
          var applicants = [];

          snapshot.forEach(childSnapshot => {
            applicants.push(childSnapshot.val());
          });
          AddAllItemsToTable(applicants);
        });
      }
      
      //once window loads, it get the data automatically
      window.onload = GetAllDataOnce;    
    </script>

        
      </section>
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
    <script src="main.js"></script>
  </body>
</html>